import pandas as pd
import matplotlib.pyplot as plt

# 数据（已核对）
data = {
    "城市": ["温州","东莞","惠州","郑州","福州","石家庄","青岛","宁波","兰州","徐州","烟台","武汉","苏州","天津","重庆","南京","中山","绍兴","南昌","济南","贵阳","南宁","合肥","香港","常州","杭州","沈阳","深圳","大连","厦门","无锡","佛山","太原","珠海","昆明","广州","海口","哈尔滨","西安","长沙","三亚","成都","泉州","长春","上海","北京","乌鲁木齐"],
    "回撤": [-63.14,-58.82,-49.01,-48.37,-45.96,-44.63,-43.41,-43.24,-43.05,-42.40,-41.37,-41.17,-40.54,-40.43,-39.98,-38.90,-38.65,-38.34,-36.15,-35.34,-35.14,-33.26,-33.10,-32.68,-31.53,-30.31,-30.23,-30.06,-30.05,-30.00,-29.82,-29.82,-29.38,-29.03,-28.06,-27.74,-27.56,-25.97,-25.39,-24.14,-23.74,-23.03,-22.93,-21.21,-20.02,-17.80,-14.04],
    "峰值时刻": ["2011-03","2021-06","2021-05","2017-08","2018-03","2017-07","2018-06","2021-06","2020-02","2021-07","2018-08","2018-03","2019-09","2017-05","2018-07","2021-08","2018-07","2021-07","2019-06","2018-06","2018-09","2019-10","2021-08","2021-11","2021-08","2021-07","2020-09","2021-02","2021-07","2017-08","2021-07","2017-09","2018-11","2018-08","2021-04","2021-08","2021-10","2020-03","2021-06","2018-06","2019-06","2018-05","2021-09","2019-05","2021-07","2017-06","2021-04"]
}
df = pd.DataFrame(data).sort_values("回撤").reset_index(drop=True)

# 绘图
plt.style.use("seaborn-v0_8")
fig, ax = plt.subplots(figsize=(12, 24))
bars = ax.barh(df["城市"], df["回撤"], color=plt.cm.RdYlGn_r(df["回撤"]/100*(-1)+0.5))
ax.set_xlabel("回撤幅度 (%)", fontsize=14)
ax.set_title("2025年6月主要城市房价回撤幅度对比（峰值至今）", fontsize=18, pad=20)
ax.set_xlim(-70, 0)
ax.bar_label(bars, labels=[f'{v:.1f}%' for v in df["回撤"]], padding=3)
# 右侧标注峰值时间
for i, (city, peak) in enumerate(zip(df["城市"], df["峰值时刻"])):
    ax.text(-2, i, f'峰值:{peak}', va='center', ha='right', color='grey', fontsize=9)
plt.tight_layout()
plt.savefig("房价回撤_高清图表.png", dpi=300, transparent=False)
plt.show()
